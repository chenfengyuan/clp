(defpackage :cfy.count-time
  (:use :cl)
  (:nicknames :ct)
  (:export :ct-init :ct-count))
(in-package :cfy.count-time)
(defun ct-init ()
  (make-hash-table :test #'equalp))
(defmacro ct-count (ct &body body)
  (let ((str (format nil "~{~a~}" body))
	(start (gensym))
	(result (gensym)))
    `(let (,start ,result)
       (unless (gethash ,str ,ct)
	 (setf (gethash ,str ,ct) (make-array 0 :adjustable t :fill-pointer 0)))
       (setf ,start (get-internal-real-time))
       (setf ,result (progn,@body))
       (vector-push-extend (- (get-internal-real-time) ,start) (gethash ,str ,ct))
       ,result)))
